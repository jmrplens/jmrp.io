---
/**
 * Publications Page.
 * Lists academic publications stored in `src/data/publications/bibliography/papers.bib`.
 * Supports abstract toggling, BibTeX copying, and external links (DOI, PDF, Slides).
 */
import BaseLayout from "@layouts/BaseLayout.astro";
import { getPublications } from "@utils/publications";
import { Icon } from "astro-icon/components";
import CopyButton from "@components/ui/CopyButton.astro";
import PublicationItem from "@components/publications/PublicationItem.astro";

const publicationGroups = await getPublications();

const publicationsSchema = {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: "Publications",
    hasPart: publicationGroups.flatMap((group) =>
        group.items.map((pub: any) => ({
            "@type": "ScholarlyArticle",
            headline: pub.title,
            datePublished: pub.issued?.["date-parts"]?.[0]?.join("-"),
            author: pub.author?.map((a: any) => ({
                "@type": "Person",
                name: `${a.given} ${a.family}`,
            })),
            publication:
                pub["container-title"] || pub.publisher || pub.school || "N/A",
            sameAs: pub.DOI ? `https://doi.org/${pub.DOI}` : undefined,
            url: pub.URL || undefined,
            abstract: pub.abstract,
        })),
    ),
};
---

<BaseLayout
    title="Publications"
    description="Academic publications and research."
>
    <div class="container">
        <h1 class="page-title">Publications</h1>

        {
            publicationGroups.map((group) => (
                <section class="pub-section" aria-label={group.title}>
                    <h2 class="section-title text-primary border-b border-border pb-2">
                        {group.title}
                    </h2>
                    <div class="publications-list">
                        {group.items.map((pub: any) => (
                            <PublicationItem pub={pub} />
                        ))}
                    </div>
                </section>
            ))
        }
    </div>
</BaseLayout>

<script>
    import "@scripts/publications.js";
</script>

<style>
    .pub-section {
        margin-bottom: var(--space-xl);
    }

    .publications-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-lg);
    }

    /* Minimal styles as most logic is now in the component */
    .section-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: var(--space-md);
        display: inline-block;
        padding-right: var(--space-lg);
    }
</style>
